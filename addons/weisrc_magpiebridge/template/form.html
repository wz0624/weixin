{template 'common'}
<input type="hidden" name="reply_id" value="{$reply['id']}" />
{if $reply['id']}
<div class="panel panel-default">
    <div class="panel-heading">
        活动数据
    </div>
    <div class="panel-body">
        <div class="row-fluid">
            <div class="span8 control-group">
                <a class="btn btn-default" href="{php echo $this->createWebUrl('fanslist',array('op'=>'display', 'rid' => $rid));}">参与用户</a>
            </div>
        </div>
    </div>
</div>
{/if}
<div class="panel panel-default">
<div class="panel-heading">
    活动设置
</div>
<div class="panel-body">
    <div class="form-group">
        <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 活动名称</label>
        <div class="col-sm-9 col-xs-12">
            <input type="text" id="title" class="form-control" placeholder="" name="title" value="{$reply['title']}">
        </div>
    </div>
    <div class="form-group">
        <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 图文图片</label>
        <div class="col-sm-9 col-xs-12">
            {php echo tpl_form_field_image('start_picurl',$reply['start_picurl']);}
        </div>
    </div>
    <div class="form-group">
        <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 活动说明</label>
        <div class="col-sm-9 col-xs-12">
            <textarea style="height:60px;" id='description' name="description" class="form-control" cols="60">{$reply['description']}</textarea>
            <span class="help-block">用于户图文显示</span>
        </div>
    </div>
    <div class="form-group">
        <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 活动时间</label>
        <div class="col-sm-9 col-xs-12">
            {php echo tpl_form_field_daterange('datelimit', array('starttime'=>date('Y-m-d H:i',$reply['starttime']),'endtime'=>date('Y-m-d H:i',$reply['endtime'])), true)}
        </div>
    </div>
    <div class="form-group">
        <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 版权信息</label>
        <div class="col-sm-9 col-xs-12">
            <input type="text" class="form-control" name="copyright" value="{$reply['copyright']}" />
        </div>
    </div>
    <div class="form-group">
        <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 版权链接</label>
        <div class="col-sm-9 col-xs-12">
            <input type="text" class="form-control" name="copyrighturl" value="{$reply['copyrighturl']}" />
        </div>
    </div>
</div>
    <div class="panel-heading">
        结束设置
    </div>
    <div class="panel-body">
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 活动结束标题</label>
            <div class="col-sm-9 col-xs-12">
                <input type="text" id="end_theme" class="form-control" placeholder="" name="end_theme" value="{$reply['end_theme']}">
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 活动结束图片</label>
            <div class="col-sm-9 col-xs-12">
                {php echo tpl_form_field_image('end_picurl',$reply['end_picurl']);}
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 活动结束说明</label>
            <div class="col-sm-9 col-xs-12">
                <textarea style="height:60px;" id='end_instruction' name="end_instruction" class="form-control" cols="60">{$reply['end_instruction']}</textarea>
            </div>
        </div>
    </div>
    <div class="panel-heading">
        活动样式设置
    </div>
    <div class="panel-body">
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 首页背景</label>
            <div class="col-sm-9 col-xs-12">
                {php echo tpl_form_field_image('bg',$reply['bg']);}
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 首页开始按钮</label>
            <div class="col-sm-9 col-xs-12">
                {php echo tpl_form_field_image('btn_start',$reply['btn_start']);}
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 游戏背景</label>
            <div class="col-sm-9 col-xs-12">
                {php echo tpl_form_field_image('game_page_bg',$reply['game_page_bg']);}
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 游戏踩板背景</label>
            <div class="col-sm-9 col-xs-12">
                {php echo tpl_form_field_image('game_tile',$reply['game_tile']);}
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 游戏结果背景</label>
            <div class="col-sm-9 col-xs-12">
                {php echo tpl_form_field_image('result_page_bg',$reply['result_page_bg']);}
            </div>
        </div>
    </div>
    <div class="panel-heading">
        活动详细设置
    </div>
    <div class="panel-body">
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 底部广告</label>
            <div class="col-sm-9 col-xs-12">
                {php echo tpl_form_field_image('ad',$reply['ad']);}
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 底部广告链接</label>
            <div class="col-sm-9 col-xs-12">
                <input type="text" id="adurl" class="form-control" placeholder="" name="adurl" value="{$reply['adurl']}">
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 活动规则</label>
            <div class="col-sm-9 col-xs-12">
                <textarea style="height:200px; width:100%;" id='rule' class="form-control richtext" name="rule" cols="70">{$reply['rule']}</textarea>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 领奖说明</label>
            <div class="col-sm-9 col-xs-12">
                <textarea style="height:200px; width:100%;" id='award' class="form-control richtext" name="award" cols="70">{$reply['award']}</textarea>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 奖品说明</label>
            <div class="col-sm-9 col-xs-12">
                <textarea style="height:200px; width:100%;" id='awardtip' class="form-control" name="awardtip" cols="70">{$reply['awardtip']}</textarea>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 游戏时间</label>
            <div class="col-sm-9 col-xs-12">
                <div class="input-group">
                    <input type="text" class="form-control" name="gametime" value="{$reply['gametime']}" />
                    <span class="input-group-addon">秒</span>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 板块数量</label>
            <div class="col-sm-9 col-xs-12">
                <input type="text" class="form-control" name="gamelevel" value="{$reply['gamelevel']}" placeholder=""/>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 每人最多游戏次数</label>
            <div class="col-sm-9 col-xs-12">
                <div class="input-group">
                    <input type="text" class="form-control" name="number_times" value="{$reply['number_times']}" />
                    <span class="input-group-addon">次</span>
                </div>
                <div class="help-block">0 为不限制</div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 每人每天游戏次数</label>
            <div class="col-sm-9 col-xs-12">
                <div class="input-group">
                    <input type="text" class="form-control" name="most_num_times" value="{$reply['most_num_times']}" />
                    <span class="input-group-addon">次</span>
                </div>
                <div class="help-block">0 为不限制</div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 每人每天分享次数</label>
            <div class="col-sm-9 col-xs-12">
                <div class="input-group">
                    <span class="input-group-addon">每天可分享</span>
                    <input type="text" class="form-control" name="daysharenum" value="{$reply['daysharenum']}" />
                    <span class="input-group-addon" style="border-left:0px;border-right:0px;">次,每次增加游戏次数</span>
                    <input type="text" class="form-control" name="sharelotterynum" value="{$reply['sharelotterynum']}" />
                    <span class="input-group-addon">次</span>
                </div>
                <div class="help-block">分享次数设置0为不奖励游戏次数</div>
            </div>
        </div>
    </div>
    <div class="panel-heading">
        奖品信息
    </div>
    <div class="panel-body">
        {if $prize}
        {loop $prize $item}
        <div>
            <input type="hidden" name="prize_id[{$item['id']}]" value="{$item['id']}" />
            <div class="form-group">
                <label class="col-xs-12 col-sm-2 col-md-2 control-label">奖品类别</label>
                <div class="col-sm-2" style="width: 19.5%;">
                    <input class="form-control" type="text" value="{$item['prizetype']}" name="prizetype[{$item['id']}]">
                </div>
                <label class="col-xs-12 col-sm-1 col-md-1 control-label">奖品名称</label>
                <div class="col-sm-2" style="width: 19.5%;">
                    <input class="form-control" type="text" value="{$item['prizename']}" name="prizename[{$item['id']}]">
                </div>
                <label class="col-xs-12 col-sm-1 col-md-1 control-label">奖品数量</label>
                <div class="col-sm-2" style="width: 19.5%;">
                    <div class="input-group">
                        <input class="form-control" type="text" value="{$item['prizetotal']}" name="prizetotal[{$item['id']}]">
                        <span class="input-group-addon">份</span>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label">奖品图片</label>
                <div class="col-sm-9">
                    {php echo tpl_form_field_image('prizepic['.$item['id'].']',$item['prizepic']);}
                    <div class="help-block">奖品显示图片 图片大小418px X 418px</div>
                </div>
            </div>
            <hr/>
        </div>
        {/loop}
        {/if}
        <div id="prize" style="display: none">
            <div class="form-group">
                <label class="col-xs-12 col-sm-2 col-md-2 control-label">奖品类别</label>
                <div class="col-sm-2" style="width: 19.5%;">
                    <input class="form-control" type="text" value="" name="prizetype_new[]">
                </div>
                <label class="col-xs-12 col-sm-1 col-md-1 control-label">奖品名称</label>
                <div class="col-sm-2" style="width: 19.5%;">
                    <input class="form-control" type="text" value="" name="prizename_new[]">
                </div>
                <label class="col-xs-12 col-sm-1 col-md-1 control-label">奖品数量</label>
                <div class="col-sm-2" style="width: 19.5%;">
                    <div class="input-group">
                        <input class="form-control" type="text" value="" name="prizetotal_new[]">
                        <span class="input-group-addon">份</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label">奖品图片</label>
                <div class="col-sm-9">
                    {php echo tpl_form_field_image('prizepic_new[]','');}
                    <div class="help-block">奖品显示图片 图片大小418px X 418px</div>
                </div>
            </div>
        </div>
        {if empty($prize)}
        <div>
            <div class="form-group">
                <label class="col-xs-12 col-sm-2 col-md-2 control-label">奖品类别</label>
                <div class="col-sm-2" style="width: 19.5%;">
                    <input class="form-control" type="text" value="" name="prizetype_new[]">
                </div>
                <label class="col-xs-12 col-sm-2 col-md-1 control-label">奖品名称</label>
                <div class="col-sm-2" style="width: 19.5%;">
                    <input class="form-control" type="text" value="" name="prizename_new[]">
                </div>
                <label class="col-xs-12 col-sm-2 col-md-1 control-label">奖品数量</label>
                <div class="col-sm-2" style="width: 19.5%;">
                    <div class="input-group">
                        <input class="form-control" type="text" value="" name="prizetotal_new[]">
                        <span class="input-group-addon">份</span>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label class="col-xs-12 col-sm-3 col-md-2 control-label">奖品图片</label>
                <div class="col-sm-9">
                    {php echo tpl_form_field_image('prizepic_new[]','');}
                    <div class="help-block">奖品显示图片 图片大小418px X 418px</div>
                </div>
            </div>
            <hr/>
        </div>
        {/if}
        <span id="award_insert_flag" style="display: none"></span>
        <div class="form-group">
            <div class="col-sm-5"></div>
            <div class="col-sm-7">
                <button id="btn_add_award" type="button" class="btn btn-warning">
                    <span class="glyphicon glyphicon-plus"></span> 添加奖品
                </button>
            </div>
        </div>
    </div>
    <div class="panel-heading">
        分享设置
    </div>
    <div class="panel-body">
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 分享标题</label>
            <div class="col-sm-9 col-xs-12">
                <input type="text" id="share_title" class="form-control" placeholder="" name="share_title" value="{$reply['share_title']}">
                <div class="help-block">分享的文字，用户显示分享给用户的介绍!</div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 分享图片</label>
            <div class="col-sm-9 col-xs-12">
                {php echo tpl_form_field_image('share_image',$reply['share_image']);}
                <div class="help-block">建议尺寸640*640</div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 分享描述</label>
            <div class="col-sm-9 col-xs-12">
                <textarea style="height:60px;" name="share_desc" class="form-control" cols="60">{$reply['share_desc']}</textarea>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 分享出去链接</label>
            <div class="col-sm-9 col-xs-12">
                <input type="text" id="share_url" class="form-control" placeholder="" name="share_url" value="{$reply['share_url']}">
                <div class="help-block">用户分享的链接，不填为当前活动地址! 推荐用微信平台的素材库，转成短地址。<a target="_blank" href="http://www.dwz.cn/">短网址转换</a></div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"><span style='color:red'>*</span> 引导关注链接</label>
            <div class="col-sm-9 col-xs-12">
                <input type="text" id="follow_url" class="form-control" placeholder="" name="follow_url" value="{$reply['follow_url']}">
                <div class="help-block">引导关注链接! 推荐用微信平台的素材库，转成短地址。<a target="_blank" href="http://www.dwz.cn/">短网址转换</a></div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label">是否需要关注</label>
            <div class="col-sm-9">
                <label for="isneedfollow1" class="radio-inline"><input type="radio" name="isneedfollow" value="0" id="isneedfollow1" {if $reply['isneedfollow'] == 0}checked="true"{/if} /> 不</label>
                &nbsp;&nbsp;&nbsp;
                <label for="isneedfollow2" class="radio-inline"><input type="radio" name="isneedfollow" value="1" id="isneedfollow2"  {if $reply['isneedfollow'] == 1}checked="true"{/if} /> 是</label>
                <span class="help-block"></span>
            </div>
        </div>
    </div>
</div>
 <script>
 $('form').submit(function(){
 
   if($("#title").isEmpty()){
		Tip.focus("title","请输入活动名称!","right");
		return false;
   }
//   if($("#upload-image-url-start_picurl").isEmpty()){
//		Tip.focus("upload-image-url-start_picurl","请上传活动图片!","right");
//		return false;
//   }
    if($("#description").isEmpty()){
		Tip.focus("description","请输入活动简介!","right");
		return false;
   }
//    if($("#ticket_information").isEmpty()){
//		Tip.focus("ticket_information","请输入兑奖信息!","right");
//		return false;
//   }
//   if($("#repeat_lottery_reply").isEmpty()){
//		Tip.focus("repeat_lottery_reply","请输入重复抽奖信息!","right");
//		return false;
//   }
    if($("#end_theme").isEmpty()){
		Tip.focus("end_theme","请输入活动结束标题!","right");
		return false;
   }
//   if($("#upload-image-url-end_picurl").isEmpty()){
//		Tip.focus("upload-image-url-end_picurl","请上传活动结束图片!","right");
//		return false;
//   }
    if($("#end_instruction").isEmpty()){
		Tip.focus("end_instruction","请输入活动结束说明!","right");
		return false;
   }
   return true;
});
 function moreItem() {
	 var more = $("#more_item").val();
	 if(more=="0" || more==""){
	    $("#c_four").show();
	    $("#c_five").show();
	    $("#c_six").show();
	 }
	 else{
	    $("#c_four").hide();
	    $("#c_five").hide();
	    $("#c_six").hide();
	 }
	 $("#more_item").val(more=='1'?'0':'1');
}
function doDeleteItemImage(obj,id) {
		var filename = $('input#' + id+"-value").val();
		$('.' + id +"_preview").html("");
		$(obj).html("正在删除...").attr("disabled",true);
 		   ajaxopen('./index.php?act=attachment&do=delete&filename=' + filename, function(){
		   $(obj).html("<i class='icon-upload-alt'></i> 删除").hide().removeAttr("disabled");
		});
	}
require(['jquery', 'util'], function($, u){

     $(function(){
         u.editor($('.richtext')[0]);
         u.editor($('.richtext')[1]);
     });

});

 $('#btn_add_award').bind('click', function(){
     var content = '<div>';
     content += $("#prize").html();
     content += '<div class="form-group">';
     content += '<label class="col-xs-12 col-sm-3 col-md-2 control-label"></label>';
     content += '<div class="col-sm-9">';
     content += '<button type="button" class="btn btn-danger btn_del_award">删除</button>';
     content += '</div>';
     content += '</div>';
     content += '<hr/>';
     content += '</div>';
     $('#award_insert_flag').before(content);
     $('.btn_del_award').bind('click', function(){
         var obj = $(this).parent().parent().parent();
         obj.slideUp(300, function() {
             obj.remove();
         });
     });
 });
 </script>
 